/**
 * Copyright (C) 2003-present CompatibL. All rights reserved.
 * This file contains valuable trade secrets and may be copied, stored, used,
 * or distributed only in compliance with the terms of a written commercial
 * license from CompatibL and with the inclusion of this copyright notice.
 */
import{l as H}from"./index-Dv8cUXzf.js";import{r as t,W as x}from"./react-BmNO_Eks.js";var T={wrapper:{display:"flex",position:"relative",textAlign:"initial"},fullWidth:{width:"100%"},hide:{display:"none"}},Y=T,ee={container:{display:"flex",height:"100%",width:"100%",justifyContent:"center",alignItems:"center"}},te=ee;function re({children:r}){return x.createElement("div",{style:te.container},r)}var ne=re,ue=ne;function ie({width:r,height:i,isEditorReady:o,loading:u,_ref:p,className:h,wrapperProps:w}){return x.createElement("section",{style:{...Y.wrapper,width:r,height:i},...w},!o&&x.createElement(ue,null,u),x.createElement("div",{ref:p,style:{...Y.fullWidth,...!o&&Y.hide},className:h}))}var oe=ie,$=t.memo(oe);function ce(r){t.useEffect(r,[])}var Z=ce;function ae(r,i,o=!0){let u=t.useRef(!0);t.useEffect(u.current||!o?()=>{u.current=!1}:r,i)}var m=ae;function _(){}function O(r,i,o,u){return le(r,u)||de(r,i,o,u)}function le(r,i){return r.editor.getModel(q(r,i))}function de(r,i,o,u){return r.editor.createModel(i,o,u?q(r,u):void 0)}function q(r,i){return r.Uri.parse(i)}function se({original:r,modified:i,language:o,originalLanguage:u,modifiedLanguage:p,originalModelPath:h,modifiedModelPath:w,keepCurrentOriginalModel:y=!1,keepCurrentModifiedModel:j=!1,theme:R="light",loading:I="Loading...",options:E={},height:A="100%",width:B="100%",className:G,wrapperProps:J={},beforeMount:Q=_,onMount:X=_}){let[M,P]=t.useState(!1),[L,s]=t.useState(!0),f=t.useRef(null),d=t.useRef(null),b=t.useRef(null),g=t.useRef(X),c=t.useRef(Q),C=t.useRef(!1);Z(()=>{let e=H.init();return e.then(a=>(d.current=a)&&s(!1)).catch(a=>(a==null?void 0:a.type)!=="cancelation"&&console.error("Monaco initialization: error:",a)),()=>f.current?D():e.cancel()}),m(()=>{if(f.current&&d.current){let e=f.current.getOriginalEditor(),a=O(d.current,r||"",u||o||"text",h||"");a!==e.getModel()&&e.setModel(a)}},[h],M),m(()=>{if(f.current&&d.current){let e=f.current.getModifiedEditor(),a=O(d.current,i||"",p||o||"text",w||"");a!==e.getModel()&&e.setModel(a)}},[w],M),m(()=>{let e=f.current.getModifiedEditor();e.getOption(d.current.editor.EditorOption.readOnly)?e.setValue(i||""):i!==e.getValue()&&(e.executeEdits("",[{range:e.getModel().getFullModelRange(),text:i||"",forceMoveMarkers:!0}]),e.pushUndoStop())},[i],M),m(()=>{var e,a;(a=(e=f.current)==null?void 0:e.getModel())==null||a.original.setValue(r||"")},[r],M),m(()=>{let{original:e,modified:a}=f.current.getModel();d.current.editor.setModelLanguage(e,u||o||"text"),d.current.editor.setModelLanguage(a,p||o||"text")},[o,u,p],M),m(()=>{var e;(e=d.current)==null||e.editor.setTheme(R)},[R],M),m(()=>{var e;(e=f.current)==null||e.updateOptions(E)},[E],M);let W=t.useCallback(()=>{var V;if(!d.current)return;c.current(d.current);let e=O(d.current,r||"",u||o||"text",h||""),a=O(d.current,i||"",p||o||"text",w||"");(V=f.current)==null||V.setModel({original:e,modified:a})},[o,i,p,r,u,h,w]),F=t.useCallback(()=>{var e;!C.current&&b.current&&(f.current=d.current.editor.createDiffEditor(b.current,{automaticLayout:!0,...E}),W(),(e=d.current)==null||e.editor.setTheme(R),P(!0),C.current=!0)},[E,R,W]);t.useEffect(()=>{M&&g.current(f.current,d.current)},[M]),t.useEffect(()=>{!L&&!M&&F()},[L,M,F]);function D(){var a,V,S,N;let e=(a=f.current)==null?void 0:a.getModel();y||((V=e==null?void 0:e.original)==null||V.dispose()),j||((S=e==null?void 0:e.modified)==null||S.dispose()),(N=f.current)==null||N.dispose()}return x.createElement($,{width:B,height:A,isEditorReady:M,loading:I,_ref:b,className:G,wrapperProps:J})}var fe=se,Re=t.memo(fe);function ge(){let[r,i]=t.useState(H.__getMonacoInstance());return Z(()=>{let o;return r||(o=H.init(),o.then(u=>{i(u)})),()=>o==null?void 0:o.cancel()}),r}var Ve=ge;function pe(r){let i=t.useRef();return t.useEffect(()=>{i.current=r},[r]),i.current}var he=pe,z=new Map;function Me({defaultValue:r,defaultLanguage:i,defaultPath:o,value:u,language:p,path:h,theme:w="light",line:y,loading:j="Loading...",options:R={},overrideServices:I={},saveViewState:E=!0,keepCurrentModel:A=!1,width:B="100%",height:G="100%",className:J,wrapperProps:Q={},beforeMount:X=_,onMount:M=_,onChange:P,onValidate:L=_}){let[s,f]=t.useState(!1),[d,b]=t.useState(!0),g=t.useRef(null),c=t.useRef(null),C=t.useRef(null),W=t.useRef(M),F=t.useRef(X),D=t.useRef(),e=t.useRef(u),a=he(h),V=t.useRef(!1),S=t.useRef(!1);Z(()=>{let n=H.init();return n.then(l=>(g.current=l)&&b(!1)).catch(l=>(l==null?void 0:l.type)!=="cancelation"&&console.error("Monaco initialization: error:",l)),()=>c.current?K():n.cancel()}),m(()=>{var l,v,U,k;let n=O(g.current,r||u||"",i||p||"",h||o||"");n!==((l=c.current)==null?void 0:l.getModel())&&(E&&z.set(a,(v=c.current)==null?void 0:v.saveViewState()),(U=c.current)==null||U.setModel(n),E&&((k=c.current)==null||k.restoreViewState(z.get(h))))},[h],s),m(()=>{var n;(n=c.current)==null||n.updateOptions(R)},[R],s),m(()=>{!c.current||u===void 0||(c.current.getOption(g.current.editor.EditorOption.readOnly)?c.current.setValue(u):u!==c.current.getValue()&&(S.current=!0,c.current.executeEdits("",[{range:c.current.getModel().getFullModelRange(),text:u,forceMoveMarkers:!0}]),c.current.pushUndoStop(),S.current=!1))},[u],s),m(()=>{var l,v;let n=(l=c.current)==null?void 0:l.getModel();n&&p&&((v=g.current)==null||v.editor.setModelLanguage(n,p))},[p],s),m(()=>{var n;y!==void 0&&((n=c.current)==null||n.revealLine(y))},[y],s),m(()=>{var n;(n=g.current)==null||n.editor.setTheme(w)},[w],s);let N=t.useCallback(()=>{var n;if(!(!C.current||!g.current)&&!V.current){F.current(g.current);let l=h||o,v=O(g.current,u||r||"",i||p||"",l||"");c.current=(n=g.current)==null?void 0:n.editor.create(C.current,{model:v,automaticLayout:!0,...R},I),E&&c.current.restoreViewState(z.get(l)),g.current.editor.setTheme(w),f(!0),V.current=!0}},[r,i,o,u,p,h,R,I,E,w]);t.useEffect(()=>{s&&W.current(c.current,g.current)},[s]),t.useEffect(()=>{!d&&!s&&N()},[d,s,N]),e.current=u,t.useEffect(()=>{var n,l;s&&P&&((n=D.current)==null||n.dispose(),D.current=(l=c.current)==null?void 0:l.onDidChangeModelContent(v=>{S.current||P(c.current.getValue(),v)}))},[s,P]),t.useEffect(()=>{if(s){let n=g.current.editor.onDidChangeMarkers(l=>{var U;let v=(U=c.current.getModel())==null?void 0:U.uri;if(v&&l.find(k=>k.path===v.path)){let k=g.current.editor.getModelMarkers({resource:v});L==null||L(k)}});return()=>{n==null||n.dispose()}}return()=>{}},[s,L]);function K(){var n,l;(n=D.current)==null||n.dispose(),A?E&&z.set(h,c.current.saveViewState()):(l=c.current.getModel())==null||l.dispose(),c.current.dispose()}return x.createElement($,{width:B,height:G,isEditorReady:s,loading:j,_ref:C,className:J,wrapperProps:Q})}var ve=Me,me=t.memo(ve),Le=me;export{Re as DiffEditor,me as Editor,Le as default,H as loader,Ve as useMonaco};
